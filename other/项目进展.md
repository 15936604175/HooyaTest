对于预测某个仓库的商品a,b,c,d未来一周的销量，并且准确预测某个商品某个快递的数量，这是一个**多变量时序预测**问题，结果预测可以表现为：

- 商品a销量
- 商品a_顺丰数量
- 商品a_京东数量
- 商品b销量
- 商品b_顺丰数量
- 商品b_京东数量

这个问题可以使用简单的LSTM或GRU或Transformer预测，目前关于多变量时序预测的问题最新的研究可见
[[ICML 2025\] TQNet：高效多变量时序预测 - 知乎](https://zhuanlan.zhihu.com/p/1908842630466471890)
论文地址：[Temporal Query Network for Efficient Multivariate Time Series Forecasting](https://arxiv.org/pdf/2505.12917)

数据表：
scb_xsjl：销售记录表，存储订单的基本信息
scb_xsjlsheet：订单商品子表，存储订单中的具体商品信息
N_goods：商品主表，存储商品的基本信息
scb_kcjl_area：库存表|
scbck：仓库表



先洗出来一张大的宽表，表上数据为：每个仓库的zip，某个商品的sku和尺寸，目的地的zip，不同快递公司（UPS，Flex等）的价钱
洗数据的时候将指定发货，卡车单等一些奇奇怪怪的数据洗掉；

可以找何萧然洗一些想要的数据，将数据洗到dwd数据中台，
cxtrade数据库是生产环境，可能会影响数据库速度，洗完的数据保存在什么地方和何潇然沟通一下。

1.物流部，预测一天后或两天后，每个物流的情况是什么样的，方便物流约车
2.产品部，预测一段时间内某种产品的销售情况，方便产品上架到哪些仓库

首先测试几个大的物流公司
可以做：

- 预测某个产品的销量，并分析原因，
  数据：热门产品的每日的销量，时间（季节，星期，月，日），是否有折扣，折扣力度，是否促销，广告费用，广告渠道等
- 预测某个产品在每个仓库的销量情况；（可解释性）
- 模拟物流（按照价钱【现在更注重成本】或距离），解释为什么某个订单不走哪个物流（重解释性）
- 模拟物流，每个仓库每种物流的占比，加上规则后物流占比的变化预测，方便物流部约车



#### 类

OrderMatchResult：这是一个 引用类型 的物流匹配结果对象，使用 ref 关键字意味着方法内部对该对象的修改会直接影响外部传入的实际对象。主要字段包括：

- Logicswayoid ：物流方式ID
- SericeType ：服务类型（如"UPSInternational"、"UPSGround"等）
- WarehouseID ：仓库ID
- WarehouseName ：仓库名称
- CanZPL ：是否支持ZPL格式
- MatchFee ：匹配费用
- Result ：响应结果

scb_order_carrier：这是一个表示订单承运商信息的实体类，主要字段包括：

- id ：自增主键
- OrderID ：订单ID
- oid ：物流方式ID
- servicetype ：服务类型，通常是mondialrelay：送货到自提点
- ShipService ：承运商服务名称，可以是mondialrelay，送货到自提点，FEDEX_GROUND，UPSGround
- dianpu ：店铺名称
- temp 、 temp1 、 temp2 ：临时字段，用于存储额外信息

scb_WMS_LogisticsForWeight配置表结构：

字段名 类型 含义 ID int 配置ID 	LogisticsServiceMode string 物流服务方式 	IsChecked int 启用状态(1=启用, 0=禁用) 	Weight string 重量阈值 	Weight_Type int 重量类型(1=体积重量, 2=计费重量) 	Sort int? 配置优先级排序 	Prime_* string Prime会员相关配置

scb_LogisticsForWeight ：物流重量配置实体类，包含以下关键字段：
- Min / Max ：重量范围阈值
- LogisticsServiceMode ：物流服务模式（如UPSSurePost、UPSGround）
- LogisticsID ：物流方式ID
- IsChecked ：是否启用（1=启用）
- Warehouse ：仓库标识
- Chang / Kuan / Gao ：长/宽/高限制
- Size ：体积限制

MatchModel：number string 订单编号（退货单特别需要此编号来获取指定退货物流） 
orderId string 订单ID
 orderdate DateTime? 订单日期 
name string 订单相关名称（订单名称） 
country string 国家代码 
toCountry string 目标国家代码（配送目的地国家） 
xspt string 销售平台代码 
dianpu string 店铺信息 
isReturn bool 是否为退货订单（true=退货单） 
logicswayoid int? 物流方式ID 
servicetype string 物流服务类型 
warehouseid int? 仓库ID 
trackno string 物流跟踪号 
lywl string 来源物流（可能指原始物流信息） 
chck string 仓库代码 
filterflag int? 筛选标志 
state int? 订单状态 
temp3 string 订单类型判断标志（来自销售记录xsjl表） xszje decimal 销售总金额 temp2 string 预留字段（原系统使用，但用途未明确记录）

khname string 客户姓名 
phone string 客户电话 email string 客户邮箱 zip string 邮政编码 statsa string 州/省（可能是state的拼写错误） city string 城市 address1 string 地址1 adress string 地址（与address1可能存在重复或不同格式） fkzh string 付款账号 bz string 备注信息

ignoreAMZN bool false 是否排除AMZN（亚马逊）相关物流 ignoreRestock bool false 是否排除Restock（重新入库）相关物流 ignoreSize bool false 是否忽略尺寸（主要用于一单多件物流的运费判断） isdev bool false 是否为开发环境（用于区分开发/生产环境的不同逻辑）

details List 订单商品明细列表，包含每个商品的SKU、数量和价格

cpbh string 产品编号 sku string 商品SKU（库存单位） sl int 商品数量 price decimal 商品单价

#### 方法

BlackAddress：判断是否是高退款率地址；内设置有白名单，对特定的平台，店铺，客户豁免检查。

RecommendCpbh：如果没有库存，查找替换的商品，一样的商品不同的批次。

#### 匹配规则详细

物流匹配

固定/指定物流（5345）
国际件：如果发货国家是美国&&收货国家是加拿大或墨西哥&&店铺的名字不包含grouponvendor-ca，将物流方式id设置为48，服务类型设置为UPSInternational；
指定物流：isFind是指定物流的入口，在scb_order_carrier查找是否该订单有指定物流，若oid=4，ShipService = "UPSGround" oid=18，ShipService = "FEDEX_GROUND"，如果SericeType是Transportation-wayfair，temp中保存了指定仓库的id，指定仓库；

初始化重量尺寸等（5404）：weight_vol体积重量，weight：实际重量，weight_phy：物理重量，weight_c：计费重量
获取已经禁用的物流方式，查询订单中商品的明细，从N_goods中查询商品的尺寸（确保商品没有组合产品groupflag=0），重量的初始单位为克，记录商品的长宽高，以及重量，体积参数volNum=长+2*（宽+高），volNum2 = 长 * 宽 * 高，计算体积重量：weight_vol = (double)volNum2 / 250，250是体积重量参数，物理重量要取体积重量和实际重量的最大值。获取长宽高中最大尺寸：maxNum，第二尺寸：secNum。

第一轮（5433）【**SmartPost** 是 **FedEx SmartPost**（现为 **FedEx Ground Economy**）的简称，是 FedEx 和美国邮政（USPS）合作的一种**经济型混合物流服务**，FedEx 负责长途干线运输，USPS（美国邮政）负责最后一公里的投递到邮箱。】
筛选出来物流重量配置表（IsChecked == 1 ：筛选已启用的配置，Sort == 1 ：筛选排序第一的主配置），通过配置判断计费重量计算是按照体积重量还是物理重量，从scb_WMS_MatchRule物流匹配规则表里面查找该商品是否是Allow_SmartPost，如果是则Logicswayoid = 18，SericeType = "FEDEX_GROUND"。如果不是且重量weight<1【没有实现逻辑】，如果1 <= weight && weight < 9 && maxNum < 34 && secNum < 17，判断UPS和Fedex的体积重量大于weight且小于9，若是指定物流为UPSSurePost，若1 < ups_weight && ups_weight < 9 && fedex_weight >= 9，指定物流为UPSSurePost，若ups_weight > weight && fedex_weight > weight && ups_weight >= 9 && fedex_weight >= 9指定物流为UPSGround。若订单的计费重量大于 配置表中的阈值重量，且FEDEX_GROUND物流未被禁用，则物流方式设置为FEDEX_GROUND；当订单重量小于配置阈值，但FEDEX_GROUND未被禁用时，继续检查尺寸和体积条件，条件：最大尺寸在范围内，第二大尺寸超过最小值，体积在范围内条件满足一条发送FEDEX_GROUND。

第二轮（5508）：
weight_g使用"四舍六入五成双"模式,从数据库查询所有 启用 （ IsChecked == 1 ）且 仓库为Ontario 的物流重量配置,判断当前订单重量 ic 是否在配置项的重量范围内（ Min ≤ ic ≤ Max ）,将符合条件的配置项添加到 dtc 列表中;遍历所有符合重量条件的物流配置,优先检查是否有 UPSSurePost 物流方式（一种经济型UPS服务）,一旦找到UPSSurePost配置，立即进行尺寸和体积验证并跳出循环,如果全部满足 ：使用该UPSSurePost配置,如果不满足 ：降级为UPSGround （LogisticsID=4），如果遍历完所有配置后都没有找到UPSSurePost（flag仍为false），则直接使用符合重量条件的第一个物流配置。





MatchLogisticsByUSV3

##### 基础信息(7805)

【%基础信息%
确认一些容易混淆的州名，一些偏远的州如HI,PR不能配送，使用SQL查询获取符合条件的美国仓库信息，包括每个仓库可用的物流模式。
第三方仓库：根据MatchModel的name判断是否为第三方仓库，name为wms是第三方仓库，获取订单的产品编号
特殊要求：overstock北美店铺空气净化器的订单地址是加州（从之前获取的匹配规则列表( MatchRules )中查找特定类型的规则（Ban_Overstock_CA_AirPurifier），获取该禁售规则的详细配置，检查当前订单是否包含禁售的空气净化器）

黑名单（7862）
查找type为Blacklist的匹配规则，查找地域黑名单和用户黑名单的详情匹配规则，还包括一些政府限制（如罗马伞不能在美国卖，加州政府限制一些商品销售），婴儿车，一些商品禁止在加拿大销售，是否是高退货率地址

卡车单（8037）
查找type为Transportation的匹配规则，获取匹配规则的细节，判断是否包含卡车单，包含卡车单手动处理。

CanCAToUS（8054）
查找type为CAToUSWarehouse的匹配规则，获取匹配规则的细节，查找type为NoCAToUSGood的匹配规则并获取细节，判断该业务规则是否为Only_UPSGround_Send，如果店铺也在Only_UPSGround_Send匹配规则店铺范围中，将OnlyUPS设置为1；判断订单商品中是否含有禁止从加拿大仓库发往美国的商品：AnyNoCanSendCAGood

分体式空调（8079）
查找type为UnPack_AirconditionPart的匹配规则，获取匹配规则的对象列表，获取配件id，若订单中含有配件，isAircondition = true，获取箱子编号，如果找到箱子编号，联系运营确认，判断订单中是否还含有非配件的编号，若有则拆单。%基础信息%】



##### 指定物流（8113）

isFind是指定物流的入口，isAppoint标记订单是否含有指定物流，在scb_order_carrier查找是否该订单有指定物流，若oid=4，ShipService = "UPSGround" oid=18，ShipService = "FEDEX_GROUND"，如果SericeType是Transportation-wayfair，temp中保存了指定仓库的id，指定仓库；
如果发货国家是美国&&收货国家是加拿大或墨西哥&&Logicswayoid，将物流方式id设置为48，服务类型设置为UPSInternational；
如果店铺名称为’fdsus‘，且订单承运商为22，则为卡车单，需要手动处理（**重复**），如果订单承运商为34，且temp为空，则为自提单；若temp不为空则为指定仓库，temp保存的是指定仓库。

特殊需求：针对wayfair平台补发重发不用指定仓库，无需提示，正常匹配就可以了（8162）
如果平台是wayfair并且指定仓库，同时不是补发单且不是重发单，则需要特殊逻辑：查询指定仓库的有效库存，只返回有效库存大于订单数量的仓库，如果没有尝试推荐替换货号，不管找到没有都要返回说明。（20250804）wayfair补发单重发单需要指定仓库。如果店铺包含wayfair或skonyon且temp不为空（指定仓库），直接指定仓库无需匹配。

如果承运商的oid为4，且店铺名包含overstock-supplier则OnlyUPS=true

wayfair平台：如果sericeType为Transportation-wayfair，就是指定仓库的卡车单， "wayfair-topbuy","wayfair-gymax","wayfairgw"需要人为干涉确认指定仓发货，不是这些店铺自动指定仓库；

Vendor ca
如果销售平台是Vendor，目的地是CA，先判断订单数量是否大于1，因为vendor CA订单不支持多包发货；查找美国仓库中该商品的有效库存信息，过滤（只有几个仓库可以发到CA），US116仓库只发-w店铺，优先发虚拟仓库（US116，US21，US121），如果没有虚拟仓可发，可以发中转仓指定oid以及SericeType；

特殊指定（8310）
若IsAppoint为false，没有预先指定物流方式，按照商品的编号或店铺或沃尔玛次日达，指定FEDEX_GROUND物流，UPSGround，UPSGround
特殊需求：特定店铺的某个产品编号指定物流；当订单来自WalmartVendor或wayfair平台时，从所有可用仓库的物流服务列表中移除ID为24的物流服务 。

仓库物流禁用ups和fedex互换（8375）
仅处理 没有运单号 的订单，检查系统中是否存在"Ban_Fedex_ConvertUPSGround"规则且当前订单已匹配的物流是 FedEx Ground，如果商品中有（商品和店铺维度）该规则，从每个仓库的物流服务列表（oids）中移除FedEx Ground；（逻辑上有疑问，代码的功能如果是禁用ups和fedex互换，不应是如果当前的SericeType是UPS那么删除仓库中oid为18，即fedex吗）



##### 邮编校验+偏远邮编校验 这些地址无法匹配（8407）

如果系统存在Remote_Districts规则，只有当前店铺不在例外列表中且收货国家为美国时，才执行邮编和州的校验。使用缓存的邮编数据（ _cacheZip ）查找当前订单的邮编，如果邮编存在但属于禁止发货的州（AK、HI、PR），则返回错误，如果邮编不存在于缓存中，则判定为无效邮编；检查是否启用了"Remote_DistrictsByPobox"（PO Box限制）规则，只有当前店铺不在例外列表中时，才执行PO Box地址检查，对收货地址进行标准化处理（去除空格、点号，转为小写）后检查是否包含"pobox"，如果包含PO Box地址，则返回错误。

##### 初始化重量尺寸（8444）

weight_vol体积重量，weightReal：实际重量，weight：订单总重量，weight_g：克为单位的重量；cpRealSizeinfos：真实尺寸；cpExpressSizeinfos：打单尺寸weight_phy：体积重量和订单总重量的最大值，weight_vol = (double)volNum2 / 250，250是体积重量参数，长宽高中最大尺寸：maxNum，第二尺寸：secNum。
将订单中的商品按商品编号（cpbh）进行去重分组，isExsitPrecbph 用于标记当前商品是否为预售产品，判断是否有预售产品，预售产品手动处理，如果sizesum > 165且不是空调配件，返回报错尺寸过大，手动处理，weight > 150手动处理，sizes.Max() > 108手动处理。若为空调，找空白纸箱信息，并记录尺寸重量。

##### 指定仓库openbox（8567）



##### 仓库匹配（8599）重要

_cacheZip ：系统缓存的邮编-配送区域映射数据，结构如下，检查订单模型( model )中的 chck 字段是否不为空，如果chck是openbox，指定仓库。Origin : 代表仓库代码或位置，DestZip : 代表用户的目的地邮编，GNDZone：地面运输区域编号，TNTDAYS : 是 预计运输天数，State : 目的地所在的州；美国邮编是5位数字，前3-4位代表地理区域，通过前缀匹配可以找到订单所在区域的所有可能配送方案，匹配到多条记录后，系统会根据各种因素进一步筛选。相同的Origin按照OriginSort排序，可以理解为同一个州有不同的仓库，每个仓库的优先级不同。
![image-20251208170305063](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20251208170305063.png)

从可用仓库列表( Warehouses )中筛选出 Origin （始发地代码）不为空的仓库，检查是否已经指定了仓库名称，定义排序变量 sort_i ，用于为匹配的仓库分配排序序号，从邮编缓存( _cacheZip )中查找与订单邮编匹配的记录，检查是否找到匹配的邮编记录。首先按 GNDZone （地面配送区域）排序，然后按 TNTDAYS （配送天数）排序，如果 states 变量为空，则从第一个邮编记录中获取州信息，states ：订单目的地所在的州，用于后续物流计算；Origin ：从邮编记录中获取始发地代码，从仓库列表中筛选出始发地代码匹配的仓库，并按 OriginSort 排序，为每个匹配的仓库设置属性（设置仓库的排序值越小优先级越高，设置仓库的地面配送区域）并添加到结果列表。

##### 匹配仓库（8648）

国际件：如果发货国家是美国&&收货国家是加拿大或墨西哥&&店铺的名字不包含grouponvendor-ca，将物流方式id设置为48，服务类型设置为UPSInternational；
仓库过滤：从可用仓库中过滤restock仓库（保留US121），过滤US98仓库，
CA订单的逻辑：从所有仓库中筛选出符合基本条件的仓库集合( cklist )，常规仓库列表 ：创建 WarehouseList ，并移除退货仓和US98仓；特殊仓库分离 ：从 WarehouseList 中移除CA_Fedex规则指定的仓库（该特殊仓库需要优先发，所有从常规仓库列表中移除）。核心仓库优先级 ：将US121、US21等核心跨境仓库添加到 lcks 并设置最高优先级（lcks中是按照优先级排序好的可发仓库），CA_Fedex仓库优先级 ：将分离出的CA_Fedex仓库添加到 lcks 并设置次高优先级，常规仓库补充 ：将剩余的常规仓库添加到 lcks。最终排序 ： lcks 中的仓库按 Sort 字段值升序排列（负数在前，数值越小优先级越高）
CA订单会有特殊需求！！！（8710）
MX订单仓库选择逻辑：从所有可用仓库中去掉US121和US21
检查第一个仓库是否是west（西部仓库），如果是西部仓库且可用仓库中包含US98仓库，则将US98仓库的优先级提高（-50）。
如果店铺是Costway-Jandy，就只能发US07和US11仓库。

分配（8782）

查询所有美国（countryid="01"）的restock仓库（退货/补货仓库），遍历订单中的商品，如果该商品已在ws字典中（表示已分配仓库），则跳过处理。使用SQL语句查找美国仓库（Warehouse like 'US%'）且有效库存足够的记录，筛选仓库：排除US07仓库，排除FBA仓库。
特殊需求：如加拿大发美国的所有物流都停

Target 按照平台指定仓库发货  重发、补发正常匹配（8826）

排除特定类型订单（重发/补发订单），从数据库表 scb_order_carrier 中查询当前订单的物流信息，确保物流信息存在且 temp 字段不为空，当 carrier.temp == "restock" 时，从 restockck 列表中筛选符合条件的退货/补货仓库。当 carrier.temp 包含具体仓库编号时，将仓库编号按逗号分割并转换为整数列表，从 Warehouses 列表中查找对应的仓库ID。判断指定仓库是否有可用库存。

禁发restock（8861）

从预定义的 restockck 列表中提取所有restock仓库的ID，检查当前可用仓库列表 list 中是否包含任何restock仓库。从 MatchRules 中查找类型为 "Ban_Restock" 的规则，从 scb_WMS_MatchRule_Details 表中获取该规则的具体配置，获取不允许发restock仓库的店铺名称列表和不允许发restock仓库的商品编号列表。当订单模型中的 ignoreRestock 属性为 true 时，从可用仓库列表 list 中移除所有restock仓库；可用仓库列表中包含restock仓库 ( isContainRestock 为 true )，订单店铺在禁止列表中或当前商品编号以"JL"开头或当前商品编号在禁止商品列表中，从可用仓库列表 list 中移除所有restock仓库。
特殊需求：如只有restock有货可发：重发，补发单+homedepot+fdsus-bp，进行提示，数据组手动派单即可

CanCAToUS（9069）

条件：订单目的地必须是美国，不是仅使用UPS物流的订单，系统规则允许加拿大仓库US21发货到美国，当前可用仓库列表中包含US21仓库，排除以"prime"结尾的店铺（如Amazon Prime）；获取了两类关键的匹配规则：禁止从加拿大发FedEx到美国的规则，优先从加拿大发货到美国的商品规则，代码进一步筛选可用仓库；CanCAToUS这个标识是否可以从CA发货到US。
特殊需求：如；20241017 邹璐 沃尔玛OLAKIDS店铺目这些SKU需要从加拿大发货到美国
如果CanCAToUS=true；当前可用仓库列表中包含US21仓库且系统规则允许从US21仓库发货，检查是否有其他美国仓库，只有当存在其他美国仓库时，才执行数量限制检查，如果US21是唯一可用仓库，则不受数量限制，获取类型为"US21_FedexToUS"的规则和"limit"的详细参数，查询当天从US21仓库（warehouseid=141）使用FedEx物流（logicswayoid=79）发往美国的订单总数，排除测试订单（Order%）和退货订单（return%），如果查询结果超过限制数量，则设置 exceedQtyLimit = true，同时将 CanCAToUS 设置为 false ，表示不再允许从加拿大发货到美国。US21优先级设置：从 Warehouses 列表中获取US21仓库对象，如果仓库存在且未超过数量限制，将 CanCAToUS 重新设置为 true （确保允许发货），设置 tt.Sort = 10099 ：为US21仓库设置低优先级。如果系统规则不允许从US21仓库发货，则从可用仓库列表 list 中排除US21仓库。

优先本地仓（9203）

US21和US121应该是加拿大仓库；查看系统中定义的所有匹配规则集合中是否有PriorityLocalWarehouse，检查当前商品编号（ item.cpbh ）是否在该规则的适用范围内，当订单目的地为美国（ model.toCountry == "US" ），且存在非加拿大仓库，禁止从加拿大发货到美国；当订单目的地为加拿大，且存在加拿大仓库，则将可用仓库列表 list 筛选为 仅包含加拿大仓库；

同款替换 指定仓库（9234）

从数据库表 scb_order_cpbh_Replace 中查询 同款替换信息（必须指定了仓库 ( appointWare 不为空)），重发、补发等特殊订单类型不应用此规则，将可用仓库列表 list 过滤为仅包含指定仓库的记录。

指定发UPS的店铺排除US15仓；（US15仓不能发送UPSGround），特殊需求：US17仓库的优先级最低，如果本地仓库还有其他库存，哪怕很便宜，也发其他仓库。指定发UPS的店铺排除US10,US04,US17，US78，US136不能发UPS

CA中转仓特殊规则【中转仓：US11，US16，US06，US15，US17（50内优先US17，如果超过50尽量不要选US17）】

只有当订单发往加拿大且没有加拿大本地仓可用时，才会使用美国中转仓，根据业务调整单量限制，执行SQL查询统计US17仓库当天已发货的加拿大订单数量，如果当前单量未超过限制（qtytmp <= tac_limt），重量<=50时，优先使用US17仓库，重量>50时，如果有其他中转仓可用，则排除US17仓库。US15限单370单。



##### 获取有效仓库（9373）

判断该订单有几种商品，如果只有一种商品，判断是否有合适的仓库，没有则推荐替换货号；有则有效库存就是合适的库存。若含有多种商品，有效仓库就是每种商品（cpbh）合适仓库的交集。有效仓库若为空，报错；非空，开始指定物流；IsExistBySerice表示是否找到匹配的物流服务的标识。通过指定物流再次筛选有效仓库，OnlyUPS（首先 排除不能发UPS的仓库 ：US10, US04, US17, US78, US136，对加拿大(CA)订单进行 额外处理 ：进一步排除US17仓库），UPSGround或UPSInternational，目标国家不是加拿大(CA)（排除不能发UPS的仓库：US10, US17, US04, US78, US136）。判断是否oversize ，且指定fedex，换fedex-3rd：如果目标国家是美国(US)，商品尺寸超过标准尺寸但小于超大尺寸，店铺没有FedEx第三方付款账号，物流方式包含"FEDEX"，则尝试匹配并筛选FedEx-3rd_Ca 物流方式的仓库，如果没有，尝试匹配并筛选 FedEx-3rd_Nj 物流方式的仓库，没有有效仓库返回报错。通过 IsInternational 标志判断当前订单是否为国际件，当选中仓库的 Origin (来源地)为"CA"(加拿大)时，将 IsExistBySerice 设置为 false，对于非加拿大仓库的国际件，直接配置为UPS国际物流。如果只有一个有效仓库，将 IsExistBySerice 设置为 true （表示找到匹配的物流服务），置订单匹配对象的 WarehouseID （仓库编号）和WarehouseName （仓库名称）

##### 匹配合适的物流（9538）

判断仓库和物流是否已经匹配完成，常规匹配完成 ： IsExistBySerice 为true且 OrderMatch.WarehouseID 不为0或销售平台( xspt )为"vendor"、目的地国家( toCountry )为"CA"、仓库ID和物流方式ID都已设置。在匹配完成的基础上，对特定条件的订单进行物流方式调整：CanCAToUS 为true，当前物流方式ID为18，仓库为US21或US121，目的地国家为US，满足上述条件时，将物流方式从ID 18调整为79，物流服务类型从原来的改为"FedexToUS"。特殊需求：只发fedex ；tangavendor这个店铺的订单匹配仓库的优先级进行调整，US11放在最后HW66067



#### MatchActualWarehouseUSV3

过滤有效仓库：特殊处理商品（分体式空调），加拿大订单，墨西哥订单。美国订单需要进行USPS判断，如果美国无库存，加拿大有库存选择特殊的物流方式，从数据库中获取商品的物流运费表，并计算特殊物流的费用（Xmile、Roadie、GOFO、Fimile、Westnovo、Ontrac等），遍历仓库和物流的组合匹配：计算每种仓库+物流方式的费用，业务规则过滤（一些邮箱只能发UPS或FedEx，特定仓库不发一些物流，体积上限，订单量上限等），对于OverSize的订单获取卡车费用，最后的仓库物流匹配按照费用优先，GNDZone次优先，OriginSort最后优先。















